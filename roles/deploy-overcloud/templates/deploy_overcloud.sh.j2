#!/bin/bash


openstack overcloud deploy \
    --templates /usr/share/openstack-tripleo-heat-templates \
    --libvirt-type qemu \
    --timeout 90  \
    --roles-file {{ working_dir }}/roles_data.yaml \
    -e /usr/share/openstack-tripleo-heat-templates/environments/docker.yaml  \
    -e /usr/share/openstack-tripleo-heat-templates/environments/docker-ha.yaml  \
    -e {{ working_dir }}/docker_registry.yaml  \
    -e /usr/share/openstack-tripleo-heat-templates/environments/network-isolation.yaml \
    -e {{ working_dir }}/network-environment.yaml  \
    -e /usr/share/openstack-tripleo-heat-templates/environments/low-memory-usage.yaml     \
    -e /usr/share/openstack-tripleo-heat-templates/environments/disable-telemetry.yaml   \
    --validation-warnings-fatal   --compute-scale {{ compute_scale }} --control-scale {{ control_scale }}  --ntp-server pool.ntp.org \
    ${DEPLOY_ENV_YAML:+-e $DEPLOY_ENV_YAML} "$@" && status_code=0 || status_code=$?



